{
  "review_id": "tier2-type-validation-001",
  "review_type": "entity_type_validation",
  "tier": 2,
  "prerequisite": "Tier 1 boundary review completion",
  "created_date": "2025-11-25",
  "status": "READY_FOR_EXECUTION",
  "blocking_status": "WAITING_FOR_TIER1_COMPLETION",
  "summary": "Entity type classification validation framework for 18 entity types across 678 files",

  "prerequisite_check": {
    "tier1_completion": {
      "status": "NOT_STARTED",
      "required_files": [
        "Tier1_Boundary_Corrections.json",
        "Tier1_Validation_Report.json"
      ],
      "blocking_reason": "No annotated files available yet - project in Week 1 planning phase",
      "expected_availability": "Week 2-3 after annotation begins"
    },
    "annotation_infrastructure": {
      "status": "DOCUMENTED",
      "workflow_defined": true,
      "entity_schema_complete": true,
      "guidelines_complete": true
    }
  },

  "validation_framework": {
    "scope": {
      "total_files": 678,
      "sample_size": 169,
      "sample_percentage": 0.25,
      "sampling_strategy": "stratified_random",
      "entity_types_to_validate": 18,
      "entities_per_file_estimate": 15,
      "total_entities_to_review": 2535
    },

    "entity_type_taxonomy": {
      "technical_entities": {
        "count": 10,
        "types": [
          "EQUIPMENT",
          "CVE",
          "SECTOR",
          "THREAT_ACTOR",
          "TECHNIQUE",
          "ORGANIZATION",
          "FACILITY",
          "PROCESS",
          "MEASUREMENT",
          "PROPERTY"
        ],
        "validation_focus": [
          "Equipment vs facility disambiguation",
          "Technique vs process separation",
          "Organization vs threat actor distinction"
        ]
      },

      "psychological_entities": {
        "count": 8,
        "types": [
          "COGNITIVE_BIAS",
          "EMOTION",
          "THREAT_PERCEPTION",
          "ATTACKER_MOTIVATION",
          "DEFENSE_MECHANISM",
          "SECURITY_CULTURE",
          "HISTORICAL_PATTERN",
          "FUTURE_THREAT"
        ],
        "validation_focus": [
          "Cognitive bias subtype accuracy (30 bias types)",
          "Emotion vs defense mechanism distinction",
          "Threat perception classification (Real/Imaginary/Symbolic)",
          "Attacker motivation MICE framework compliance"
        ]
      }
    },

    "validation_protocol": {
      "phase_1_random_sampling": {
        "description": "Select 25% of annotated files randomly stratified by document type",
        "sample_size": 169,
        "stratification_criteria": [
          "Document category (Cognitive Biases, Cold Storage, Commercial, etc.)",
          "Document length (short <500 words, medium 500-1500, long >1500)",
          "Entity density (low <10, medium 10-20, high >20 entities)"
        ],
        "execution_method": "Python script with sklearn.model_selection.train_test_split"
      },

      "phase_2_entity_extraction": {
        "description": "Extract all entities from sampled files",
        "method": "Load Tier1-corrected annotations from Prodigy JSONL",
        "target_entities": 2535,
        "data_structure": {
          "entity_id": "unique identifier",
          "text": "entity span text",
          "label": "assigned entity type",
          "start_char": "character offset start",
          "end_char": "character offset end",
          "context": "surrounding text for validation",
          "attributes": "entity-specific attributes (e.g., bias_type)",
          "file_source": "source document path",
          "annotator": "primary annotator ID"
        }
      },

      "phase_3_type_classification_review": {
        "description": "Validate entity type assignments against schema guidelines",
        "review_categories": [
          {
            "category": "correctly_classified",
            "criteria": "Entity type matches schema definition and guidelines exactly",
            "action": "No correction needed"
          },
          {
            "category": "ambiguous_but_acceptable",
            "criteria": "Entity could fit multiple types, but assigned type is defensible",
            "action": "Document rationale, no correction"
          },
          {
            "category": "misclassified",
            "criteria": "Entity type does not match schema definition",
            "action": "Reclassify to correct type"
          },
          {
            "category": "subtype_error",
            "criteria": "Correct primary type but wrong attribute (e.g., wrong bias_type)",
            "action": "Correct attribute only"
          },
          {
            "category": "boundary_dependent_error",
            "criteria": "Type error caused by incorrect boundary from Tier 1",
            "action": "Flag for Tier 1 re-review"
          }
        ],

        "validation_checklist": {
          "COGNITIVE_BIAS": [
            "Is the bias one of the 30 defined bias types?",
            "Is the bias_type attribute correctly assigned?",
            "Is the bias_category correct (perception/decision/group/temporal/attribution/attention/complexity)?",
            "Does the context support the bias classification?"
          ],

          "EMOTION": [
            "Is this truly an emotional state vs a cognitive process?",
            "Is it distinguishable from DEFENSE_MECHANISM?",
            "Examples: anxiety, panic, denial, complacency, fear, frustration"
          ],

          "THREAT_PERCEPTION": [
            "Is the perception_type attribute correct (Real/Imaginary/Symbolic)?",
            "Real = actual verified threat with evidence",
            "Imaginary = perceived threat without evidence",
            "Symbolic = threat to identity/values not physical",
            "Is evidence_level attribute appropriate?"
          ],

          "ATTACKER_MOTIVATION": [
            "Does motivation fit MICE framework (Money/Ideology/Coercion/Ego)?",
            "Or does it fit additional motives (Hacktivism/Espionage/Sabotage/Insider)?",
            "Is motivation_type attribute correctly assigned?",
            "Is framework attribute accurate?"
          ],

          "DEFENSE_MECHANISM": [
            "Is this a psychological defense response?",
            "Is it distinguishable from EMOTION?",
            "Examples: Denial, Rationalization, Projection, Displacement"
          ],

          "EQUIPMENT": [
            "Is this ICS/SCADA/OT equipment specifically?",
            "Not general IT equipment unless in ICS context",
            "Includes: PLCs, HMIs, RTUs, industrial controllers"
          ],

          "CVE": [
            "Does it match CVE format: CVE-YYYY-NNNNN?",
            "Full identifier captured, not partial?"
          ],

          "SECTOR": [
            "Is this a critical infrastructure sector?",
            "Examples: Energy, Water, Manufacturing, Healthcare, Transportation"
          ],

          "THREAT_ACTOR": [
            "Is this a malicious entity (APT, insider, group)?",
            "Not confused with ORGANIZATION?"
          ],

          "TECHNIQUE": [
            "Is this an attack technique or MITRE ATT&CK reference?",
            "Not confused with PROCESS?"
          ]
        }
      },

      "phase_4_research_pattern_application": {
        "description": "Apply research patterns from Phase 1 psychometric research",
        "research_validation_checks": [
          {
            "pattern": "cognitive_bias_co_occurrence",
            "check": "When normalcy_bias appears, often accompanied by confirmation_bias",
            "action": "Verify both biases are annotated if context supports"
          },
          {
            "pattern": "emotion_defense_sequence",
            "check": "EMOTION often precedes DEFENSE_MECHANISM (e.g., anxiety → denial)",
            "action": "Verify temporal sequence and causal relationship annotation"
          },
          {
            "pattern": "threat_perception_bias_correlation",
            "check": "THREAT_PERCEPTION type correlates with specific COGNITIVE_BIAS",
            "action": "Real threats → recency_bias; Imaginary → availability_heuristic"
          },
          {
            "pattern": "attacker_motivation_technique_alignment",
            "check": "ATTACKER_MOTIVATION should align with TECHNIQUE sophistication",
            "action": "Money → ransomware; Ideology → destructive attacks; Espionage → stealthy persistence"
          }
        ]
      },

      "phase_5_automated_validation": {
        "description": "Automated checks for type classification consistency",
        "automated_checks": [
          {
            "check": "attribute_completeness",
            "rule": "COGNITIVE_BIAS must have bias_type attribute",
            "severity": "CRITICAL"
          },
          {
            "check": "attribute_completeness",
            "rule": "THREAT_PERCEPTION must have perception_type attribute",
            "severity": "CRITICAL"
          },
          {
            "check": "attribute_completeness",
            "rule": "ATTACKER_MOTIVATION must have motivation_type attribute",
            "severity": "CRITICAL"
          },
          {
            "check": "cve_format_validation",
            "rule": "CVE entities must match regex: CVE-\\d{4}-\\d{4,7}",
            "severity": "HIGH"
          },
          {
            "check": "bias_type_vocabulary",
            "rule": "bias_type must be one of 30 defined bias types",
            "severity": "CRITICAL"
          },
          {
            "check": "perception_type_vocabulary",
            "rule": "perception_type must be Real|Imaginary|Symbolic",
            "severity": "CRITICAL"
          },
          {
            "check": "entity_type_distribution",
            "rule": "Flag files with <3 or >50 entities as potential annotation issues",
            "severity": "MEDIUM"
          },
          {
            "check": "psychological_technical_balance",
            "rule": "Most files should have both psychological and technical entities",
            "severity": "LOW"
          }
        ]
      }
    },

    "confusion_matrix_analysis": {
      "description": "Identify systematic type classification errors",
      "common_confusions": [
        {
          "confusion": "EQUIPMENT vs FACILITY",
          "example": "Nuclear power plant (FACILITY) vs Control system at plant (EQUIPMENT)",
          "resolution": "FACILITY = physical location; EQUIPMENT = device/system"
        },
        {
          "confusion": "TECHNIQUE vs PROCESS",
          "example": "Lateral movement (TECHNIQUE) vs Batch production (PROCESS)",
          "resolution": "TECHNIQUE = attack method; PROCESS = industrial workflow"
        },
        {
          "confusion": "ORGANIZATION vs THREAT_ACTOR",
          "example": "DHS CISA (ORGANIZATION) vs APT28 (THREAT_ACTOR)",
          "resolution": "ORGANIZATION = legitimate entity; THREAT_ACTOR = malicious entity"
        },
        {
          "confusion": "EMOTION vs DEFENSE_MECHANISM",
          "example": "Anxiety (EMOTION) vs Denial (DEFENSE_MECHANISM)",
          "resolution": "EMOTION = feeling state; DEFENSE_MECHANISM = psychological coping response"
        },
        {
          "confusion": "COGNITIVE_BIAS vs DEFENSE_MECHANISM",
          "example": "Confirmation bias (COGNITIVE_BIAS) vs Rationalization (DEFENSE_MECHANISM)",
          "resolution": "COGNITIVE_BIAS = systematic thinking error; DEFENSE_MECHANISM = protective response"
        }
      ],

      "confusion_matrix_structure": {
        "rows": "predicted (annotated) entity types",
        "columns": "actual (correct) entity types",
        "diagonal": "correct classifications",
        "off_diagonal": "misclassifications",
        "metrics": [
          "Precision per entity type",
          "Recall per entity type",
          "F1 score per entity type",
          "Classification accuracy overall"
        ]
      }
    },

    "quality_metrics": {
      "type_classification_f1": {
        "target": 0.80,
        "minimum_acceptable": 0.75,
        "calculation": "Per-entity-type F1 score across 18 types",
        "pass_criteria": "16+ entity types achieve F1 > 0.80"
      },

      "attribute_accuracy": {
        "target": 0.90,
        "minimum_acceptable": 0.85,
        "calculation": "Correct attribute assignments / total attributes",
        "critical_attributes": [
          "bias_type (30 values)",
          "perception_type (3 values)",
          "motivation_type (8 values)"
        ]
      },

      "inter_reviewer_agreement": {
        "target": 0.85,
        "minimum_acceptable": 0.80,
        "calculation": "Cohen's Kappa between primary annotator and Tier 2 reviewer",
        "sample_size": 100
      }
    },

    "correction_protocol": {
      "reclassification_process": [
        "1. Document original classification and rationale",
        "2. Identify correct entity type based on guidelines",
        "3. Update entity label in annotation data",
        "4. Update attributes if applicable",
        "5. Log correction with justification",
        "6. Flag for re-annotation if systematic pattern detected"
      ],

      "correction_tracking": {
        "fields": [
          "entity_id",
          "original_type",
          "corrected_type",
          "original_attributes",
          "corrected_attributes",
          "correction_rationale",
          "reviewer_id",
          "correction_timestamp",
          "confidence_level"
        ]
      },

      "escalation_criteria": [
        "If >20% of entities in a file require reclassification → Flag file for complete re-annotation",
        "If >30% of specific entity type misclassified → Review guidelines and re-train annotators",
        "If systematic confusion between two types >15% → Add disambiguation examples to guidelines"
      ]
    }
  },

  "execution_workflow": {
    "step_1_load_tier1_data": {
      "input": "Tier1_Boundary_Corrections.json (or original Prodigy JSONL)",
      "action": "Load corrected annotations with proper boundaries",
      "output": "DataFrame with entity_id, text, label, attributes, context"
    },

    "step_2_random_sampling": {
      "action": "Stratified random sample of 169 files (25%)",
      "stratification": "By document category, length, entity density",
      "output": "Sample file list with stratification metadata"
    },

    "step_3_entity_extraction": {
      "action": "Extract all entities from sampled files",
      "target": "~2,535 entities (15 per file average)",
      "output": "Entity validation dataset"
    },

    "step_4_manual_type_review": {
      "action": "Expert reviewer validates type classifications",
      "method": "Present entity with context, current type, and schema guidelines",
      "tools": "Custom validation interface or spreadsheet",
      "output": "Type validation decisions for each entity"
    },

    "step_5_automated_checks": {
      "action": "Run automated validation scripts",
      "checks": "Attribute completeness, format validation, distribution checks",
      "output": "Automated validation report"
    },

    "step_6_confusion_matrix": {
      "action": "Calculate confusion matrix across 18 entity types",
      "calculation": "sklearn.metrics.confusion_matrix",
      "output": "18x18 matrix with precision, recall, F1 per type"
    },

    "step_7_apply_corrections": {
      "action": "Update annotations with corrected types and attributes",
      "method": "Batch update in Prodigy database or JSONL files",
      "output": "Tier2_Corrected_Annotations.jsonl"
    },

    "step_8_validation_report": {
      "action": "Generate comprehensive Type Validation Report",
      "contents": [
        "Type classification F1 scores per entity",
        "Confusion matrix with common misclassifications",
        "Attribute accuracy metrics",
        "Correction summary statistics",
        "Recommendations for guideline improvements"
      ],
      "output": "Tier2_Type_Validation_Report.json"
    }
  },

  "validation_metrics": {
    "type_f1_target": {
      "overall_target": 0.80,
      "per_type_breakdown": {
        "COGNITIVE_BIAS": {
          "target_f1": 0.75,
          "challenge": "30 bias subtypes create classification complexity",
          "critical_attributes": "bias_type, bias_category"
        },
        "THREAT_PERCEPTION": {
          "target_f1": 0.80,
          "challenge": "Real vs Imaginary distinction requires context analysis",
          "critical_attributes": "perception_type, evidence_level"
        },
        "EMOTION": {
          "target_f1": 0.80,
          "challenge": "Overlap with DEFENSE_MECHANISM",
          "disambiguation": "EMOTION = feeling; DEFENSE_MECHANISM = coping"
        },
        "ATTACKER_MOTIVATION": {
          "target_f1": 0.85,
          "challenge": "MICE framework application",
          "critical_attributes": "motivation_type, framework"
        },
        "EQUIPMENT": {
          "target_f1": 0.85,
          "challenge": "ICS-specific vs general IT disambiguation"
        },
        "CVE": {
          "target_f1": 0.95,
          "challenge": "Format validation, should be straightforward"
        },
        "TECHNIQUE": {
          "target_f1": 0.80,
          "challenge": "MITRE ATT&CK mapping accuracy"
        },
        "THREAT_ACTOR": {
          "target_f1": 0.85,
          "challenge": "Distinction from ORGANIZATION"
        }
      }
    },

    "success_criteria": {
      "primary": "16+ entity types achieve F1 > 0.80",
      "secondary": "Overall type classification accuracy > 0.85",
      "tertiary": "Attribute accuracy > 0.90 for critical attributes",
      "pass_gate": "All three criteria met to proceed to Tier 3"
    }
  },

  "expected_findings": {
    "anticipated_issues": [
      {
        "issue": "COGNITIVE_BIAS subtype confusion",
        "frequency": "MEDIUM",
        "impact": "HIGH",
        "mitigation": "Provide bias decision tree in guidelines"
      },
      {
        "issue": "EQUIPMENT vs FACILITY boundary ambiguity",
        "frequency": "MEDIUM",
        "impact": "MEDIUM",
        "mitigation": "Add more examples to guidelines"
      },
      {
        "issue": "EMOTION vs DEFENSE_MECHANISM overlap",
        "frequency": "LOW",
        "impact": "MEDIUM",
        "mitigation": "Clear definitions with temporal indicators"
      },
      {
        "issue": "THREAT_PERCEPTION perception_type misclassification",
        "frequency": "MEDIUM",
        "impact": "HIGH",
        "mitigation": "Evidence-based decision rubric"
      }
    ],

    "correction_estimate": {
      "total_entities_reviewed": 2535,
      "estimated_corrections": 380,
      "correction_rate": 0.15,
      "breakdown": {
        "type_reclassifications": 200,
        "attribute_corrections": 150,
        "boundary_dependent_flags": 30
      }
    }
  },

  "deliverables": {
    "tier2_corrected_annotations": {
      "file": "Tier2_Corrected_Annotations.jsonl",
      "description": "Annotations with corrected entity types and attributes",
      "format": "Prodigy JSONL with updated labels and attributes"
    },

    "type_validation_report": {
      "file": "Tier2_Type_Validation_Report.json",
      "description": "Comprehensive type classification analysis",
      "sections": [
        "Type F1 scores per entity",
        "Confusion matrix",
        "Common misclassification patterns",
        "Attribute accuracy metrics",
        "Correction statistics",
        "Guidelines improvement recommendations"
      ]
    },

    "confusion_matrix_visualization": {
      "file": "Tier2_Confusion_Matrix.png",
      "description": "18x18 heatmap of type classifications",
      "tool": "seaborn.heatmap or matplotlib"
    },

    "correction_log": {
      "file": "Tier2_Correction_Log.csv",
      "description": "Detailed log of all type corrections",
      "columns": [
        "entity_id",
        "file_source",
        "entity_text",
        "original_type",
        "corrected_type",
        "correction_rationale",
        "reviewer",
        "timestamp"
      ]
    },

    "guideline_improvements": {
      "file": "Tier2_Guideline_Recommendations.md",
      "description": "Recommended updates to annotation guidelines",
      "content": "Based on common misclassifications and confusion patterns"
    }
  },

  "timeline": {
    "prerequisite": "Tier 1 completion",
    "estimated_duration": "5-7 days",
    "breakdown": {
      "day_1": "Load data, random sampling, entity extraction",
      "day_2_3": "Manual type review (2,535 entities, ~1,200/day)",
      "day_4": "Automated validation, confusion matrix calculation",
      "day_5": "Apply corrections, generate reports",
      "day_6_7": "Quality review, guideline recommendations"
    }
  },

  "resource_requirements": {
    "personnel": {
      "expert_reviewer": "1 person with NLP and psychology expertise",
      "data_engineer": "1 person for automated scripts and data processing"
    },
    "compute": "Standard workstation, Python environment with sklearn, pandas, spacy",
    "tools": [
      "Python 3.11+",
      "pandas, numpy",
      "scikit-learn (metrics, confusion_matrix)",
      "spaCy 3.7+",
      "Jupyter notebooks",
      "Prodigy (for annotation viewing)"
    ]
  },

  "next_steps_after_tier2": {
    "tier_3_relationship_validation": {
      "focus": "Validate relationship types between entities",
      "prerequisite": "Tier 2 completion with F1 > 0.80"
    },

    "guideline_revision": {
      "action": "Update annotation guidelines based on Tier 2 findings",
      "target": "Reduce confusion patterns identified in Tier 2"
    },

    "model_training": {
      "action": "Use corrected annotations for spaCy model training",
      "goal": "Achieve >0.80 F1 in production model"
    }
  },

  "completion_criteria": {
    "tier2_complete_when": [
      "25% of files (169 files) reviewed",
      "~2,535 entities type-validated",
      "Confusion matrix calculated for 18 types",
      "Type F1 > 0.80 for 16+ entity types OR corrective action plan documented",
      "Tier2_Corrected_Annotations.jsonl generated",
      "Tier2_Type_Validation_Report.json delivered"
    ],

    "pass_criteria": {
      "green_light": "F1 > 0.80 for 16+ types → Proceed to Tier 3",
      "yellow_light": "F1 0.75-0.80 for 13-15 types → Targeted guideline improvements + re-annotate problem types",
      "red_light": "F1 < 0.75 for >5 types → Major guideline revision + re-annotate all files"
    }
  },

  "automation_scripts": {
    "tier2_validation_pipeline": {
      "script": "tier2_type_validation.py",
      "description": "End-to-end Tier 2 validation automation",
      "functions": [
        "load_tier1_annotations()",
        "stratified_sample_files(n=169)",
        "extract_entities()",
        "validate_attributes()",
        "calculate_confusion_matrix()",
        "generate_f1_scores()",
        "export_corrections()"
      ]
    },

    "attribute_validator": {
      "script": "validate_attributes.py",
      "checks": [
        "COGNITIVE_BIAS has valid bias_type",
        "THREAT_PERCEPTION has valid perception_type",
        "ATTACKER_MOTIVATION has valid motivation_type",
        "CVE matches regex pattern"
      ]
    },

    "confusion_matrix_generator": {
      "script": "generate_confusion_matrix.py",
      "output": "18x18 matrix with precision, recall, F1 per type"
    }
  }
}
